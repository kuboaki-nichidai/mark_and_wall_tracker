:linkcss:
:stylesdir: css
:stylesheet: mystyle.css
:twoinches: width='360'
:full-width: width='100%'
:three-quarters-width: width='75%'
:two-thirds-width: width='66%'
:half-width: width='50%'
:half-size:
:one-thirds-width: width='33%'
:one-quarters-width: width='25%'
:thumbnail: width='60'
:imagesdir: images
:sourcesdir: codes
:icons: font
:hide-uri-scheme!:
:figure-caption: 図
:example-caption: リスト
:table-caption: 表
:appendix-caption: 付録
:xrefstyle: short
:section-refsig:
:chapter-refsig:

// :toc:

= ロードクリーナー（異物除去ロボット）

[.lead]
異物を探索しながらコースに沿って走行し、異物を発見したらコース外へ除去する作業をくり返す異物除去ロボット（以下、ロードクリーナー）があります。
このロードクリーナーを題材に、以下の演習を実施しなさい。

:sectnums:
:sectnumlevels: 3


== 演習の準備

この演習では、分析・設計にUMLを使います。
モデル図は、astah* Professional を使って作成します。

* `models` ディレクトリに `load_cleaner.asta` と `ev3rt.asta` があることを確認します。
* 作成した図をファイルに書き出すときは、 `images` ディレクトリに保存します。
* プログラムは、`codes` ディレクトリに保存します。

== 要求分析

ロードクリーナーについて、依頼元にヒアリングした結果を、「 <<hearing_desc01>> 」に示します。


[[hearing_desc01]]
.ロードクリーナーについてのヒアリング結果
. 清掃担当者（チーフ）は、自立走行するロボット「ロードクリーナー」を使って、事業所構内の運搬経路にある異物を除去している。
. ロードクリーナーは、清掃センターに待機して、チーフの指示を待っている。
. チーフが開始指示を出すと、ロードクリーナーは、経路に沿って走行する。
. ロードクリーナーは、経路上に異物を見つけると、停止する。
. ロードクリーナーは、ホルダーアームを使って異物をつかみ、旋回して経路外へ異物を移動する。
. ロードクリーナーは、異物を経路外へ移動したら、再び経路に沿って異物を除去しながら走行する。
. チーフが停止指示を出すと、ロードクリーナーは、走行を停止する。
. 上記3から7をくり返す。

=== 【演習】要求分析のユースケース図を作成する

「 <<hearing_desc01>> 」を参照して、ロードクリーナーのユースケース図、ユースケース記述を作成しなさい。

.要求分析のユースケース図の作成
. `models` ディレクトリの `load_cleaner.asta` を開く。
. 「01_要求分析」モデルの中に仮で作成された「要求分析のユースケース図」を編集しなさい。
** アクターやユースケースのサンプルが書いてあるので、それを修正して使うか、削除して新しいものを追加しなさい。
** ユースケース記述は、ユースケースに紐付けたノートを使って作成しなさい。
. ユースケース図（ノートに書くユースケース記述も）作成できたら、`load_cleaner.asta` を保存しなさい。

.ユースケース図の保存と作業のコミット
. 作成したユースケース図をSVG画像として保存しなさい。
** `images` ディレクトリに `use_case.svg` という名前で保存します（すでに仮の画像がおいてあるので、置き換えます）。
. ここまでの作業をコミットします。


[IMPORTANT]
--
この演習では、この段階でコミットできているかどうかも評価します。
コミットを省かないよう、注意すること。
--

画像が保存できていれば、下記のユースケース図が更新されます。

[[use_case_svg]]
.【ユースケース図】ロードクリーナーのユースケース図
image::use_case.svg[ロードクリーナーのユースケース図, {tree-quarters-width}]


== システム分析

ロードクリーナーに採用する機器や環境については別途検討が進められ、「 <<hearing_desc02>> 」のように決まりました。

[[hearing_desc02]]
.ロードクリーナーに関する機器や環境等の検討結果
. ロードクリーナーには、Mindstorms EV3のキットで製作した <<load_cleaner>> のような自律走行ロボットを採用する。
. ロードクリーナーの開発には「EV3RT」を採用する。
** EV3RTは、Mindstorms EV3用のRTOSを使った開発環境。RTOSカーネルにTOPPERS/HRP3を採用し、これにMindstorms EV3用のセンサーやモーター等のライブラリが追加されている。
. このシステムによって除去するのは、 <<corn_object>> のような大きさ・形状の障害物。
. このシステムでは、 <<load_map>> のようなコースを巡回する。
. チーフの開始指示は、ロードクリーナーのEV3本体の「右ボタン」を押すことする。
. チーフの停止指示は、ロードクリーナーのEV3本体の「左ボタン」を押すことする。

[[load_cleaner]]
.ロードクリーナーに採用が決まった自律走行ロボット
image::load_cleaner.jpg[自律走行ロボット, {three-quarters-width}]


[[corn_object]]
.ロードクリーナーが除去する障害物
image::corn_object.jpg[障害物, {one-quarters-width}]


[[load_map]]
.ロードクリーナーが巡回するコース
image::load_map.png[障害物, {full-width}]


=== 【演習】システム分析の方式設計書を作成する

「 <<hearing_desc02>> 」を参照して、方式設計書を作成しなさい。

[NOTE]
--
方式設計としては他にも検討し、記載すべきことがありますが、ここでは「 <<hearing_desc02>> 」で検討した範囲を記載するだけにとどめます。
--

.システム分析の方式設計書の作成
. `models` ディレクトリの `load_cleaner.asta` を開く。
. 「02_システム分析」モデルの中に仮で作成された「方式設計書」を編集しなさい。
** 使用する機器や環境等についてノートに記載しなさい。
** 他に記載することがあれば、追記します。
. 方式設計書が作成できたら、`load_cleaner.asta` を保存しなさい。

.方式設計書の保存と作業のコミット
. 作成した方式設計書をSVG画像として保存しなさい。
** `images` ディレクトリに `system_design.svg` という名前で保存します（すでに仮の画像がおいてあるので、置き換えます）。
. ここまでの作業をコミットします。

[IMPORTANT]
--
この演習では、この段階でコミットできているかどうかも評価します。
コミットを省かないよう、注意してください。
--

画像が保存できていれば、下記のユースケース図が更新されます。

[[system_design_svg]]
.【方式設計書】ロードクリーナーの方式設計書
image::system_design.svg[ロードクリーナーの方式設計書, {tree-quarters-width}]

=== ドメイン分割図

「 <<hearing_desc02>> 」を参照して作成したドメイン分割図を <<domain_chart_svg>> に示します。

[TIP]
--
内部設計のクラス図は、この構造に基づいて作成します。
--

[[domain_chart_svg]]
.【ドメイン分割図】ロードクリーナーのドメイン分割図
image::domain_chart.svg[ロードクリーナーのドメイン分割図, {tree-quarters-width}]



== 外部設計

ロードクリーナーについて、システムの外部（アクター）とのやりとりを整理します。


=== 【演習】外部設計のクラス図を作成する（１）

手順に従って、外部設計の初期のクラス図を作成しなさい。
初期のクラス図では、サブシステムがないか検討し、システム、アクター、サブシステムの候補を示す。

.外部設計の初期のクラス図の作成
. 構造ツリーの「03_外部設計」に仮に作成してある外部設計用のクラス図を編集しなさい。
** クラス図に「01_要求分析」からアクターを追加しなさい。
** 追加したアクターのアイコン表記を「標準」に変える（ <<change_icon_face_png>> ）。
. サブシステムを検討しなさい。
** 開発単位（チーム、モジュール）が複数に分かれるところは、そこで分割する。
** 通信がある（送る側、受ける側がある）ところがあれば、そこで分割する。
. サブシステム候補が見つかった場合
** クラスを使ってサブシステムを追加する（サブシステムのシンボルもあるが、この演習ではクラスを使う）。
** 追加したクラスのステレオタイプに `subsystem` を追加する。
. サブシステムが見つからなかった場合
** システムをクラスとして追加する。
** 追加したクラスのステレオタイプに `system` を追加する。


[[change_icon_face_png]]
.クラスのアイコンを標準アイコンに変更する
image::change_icon_face.png[クラスのアイコンを標準アイコンに変更する, {half-width}]


.初期のクラス図の保存と作業のコミット
. 作成した外部設計のクラス図をSVG画像として保存しなさい。
** `images` ディレクトリに `system_design_class_01.svg` という名前で保存します（すでに仮の画像がおいてあるので、置き換えます）。
. ここまでの作業をコミットします。

[Important]
--
この演習では、この段階でコミットできているかどうかも評価します。
コミットを省かないよう、注意してください。
--

画像が保存できていれば、下記のクラス図が更新されます。

[[system_design_class_01_svg]]
.【外部設計書】ロードクリーナーの外部設計の初期のクラス図
image::system_design_class_01.svg[ロードクリーナーの外部設計の初期のクラス図, {tree-quarters-width}]


=== 【演習】外部設計のシーケンス図を作成する

手順に従って、外部設計のシーケンス図を作成しなさい。

.外部設計のシーケンス図の作成
. 構造ツリーの「03_外部設計」に仮に作成した外部設計用のシーケンス図を編集しなさい。
** ユースケースが複数ある場合は、ユースケースごとにシーケンス図を作成しなさい。
. 構造ツリーの「01_要求分析」に登録したアクターをシーケンス図にドラッグして追加しなさい。
. 構造ツリーの「03_外部設計」に登録したクラスの候補をシーケンス図にドラッグして追加しなさい。
. ユースケース記述をもとに、クラス候補の間にメッセージを追加しなさい。

.シーケンス図の保存と作業のコミット
. 作成した外部設計のシーケンス図をSVG画像として保存しなさい。
** `images` ディレクトリに `system_design_seq.svg` という名前で保存します（すでに仮の画像がおいてあるので、置き換えます）。
. ここまでの作業をコミットします。


[IMPORTANT]
--
この演習では、この段階でコミットできているかどうかも評価します。
コミットを省かないよう、注意してください。
--

画像が保存できていれば、下記のシーケンス図が更新されます。

[[system_design_seq_svg]]
.【外部設計書】ロードクリーナーの外部設計のシーケンス図
image::system_design_seq.svg[ロードクリーナーの外部設計のシーケンス図, {tree-quarters-width}]


=== 【演習】外部設計のクラス図を作成する（２）

手順に従って、外部設計のクラス図を更新しなさい。

.外部設計のクラス図の更新
. 構造ツリーの「03_外部設計」に仮に作成してある外部設計用のクラス図を編集しなさい。
. シーケンス図でそれぞれのクラス（やアクター）が受け取っているメッセージを、そのクラスの操作に追加しなさい。
. やり取りが見つかったクラス（やアクター）の間に、関連の線を引きなさい。
. やりとりに参加していないことがわかったクラス候補は、図の端の方へよけて枠で囲み「除外されたクラス」というテキストをつけておきなさい（削除しないでとっておく）。

.クラス図の保存と作業のコミット
. 作成した外部設計のシーケンス図をSVG画像として保存しなさい。
** `images` ディレクトリに `system_design_class_02.svg` という名前で保存します（すでに仮の画像がおいてあるので、置き換えます）。
. ここまでの作業をコミットします。


[IMPORTANT]
--
この演習では、この段階でコミットできているかどうかも評価します。
コミットを省かないよう、注意してください。
--

画像が保存できていれば、下記のクラス図が更新されます。

[[system_design_class_02_svg]]
.【外部設計書】ロードクリーナーの外部設計の検討後のクラス図
image::system_design_class_02.svg[ロードクリーナーの外部設計の検討後のクラス図, {tree-quarters-width}]

== 内部設計

ロードクリーナーについて、システム（またはサブシステム）の内部の構造と振舞いを作成します。


ところが、このシステムは、内部設計の設計書が作成されないまま、実装されてしまいました。
現状は <<cleaner_demo_video>> のような動作をするシステムとして実装されています。

[[cleaner_demo_video]]
.作成されたロードクリーナーのデモ動画
video::A24WsSucrKw[youtube,width=640,height=360]

この実装は、概ね依頼者の要件を満たしているので、動作には問題がないという判断がなされています。
しかし、内部設計書が作成されていないため、このままではシステムの維持や保守が困難になります。

そこで、要求分析、システム分析、外部設計の情報とこの動作から観測できる情報を元に、内部設計書を作成してください。

=== 【演習】内部設計のクラス図とステートマシン図を作成する

手順に従って、内部設計のクラス図とステートマシン図を作成しなさい。

.内部設計のクラス図とステートマシン図の作成
. 構造ツリーの「04_内部設計」に仮に作成してある内部設計用のクラス図を編集しなさい。
. システム分析の記述「 <<hearing_desc02>> 」や「方式設計書」などを参考に、クラス図にクラスを追加しなさい。
. 必要な関連を追加しなさい。
. 一旦作成したら、システムの振舞いを担うクラスの内部設計のステートマシン図を作成しなさい。
** 仮の設定として `app` パッケージの `load_cleaner` クラスの `run` メソッドが担当する操作としてステートマシン図を追加してあります。
** 他のクラスの振舞いにもステートマシン図が必要なら追加しなさい。
. ステートマシン図を作成する際に、必要となるモノや働きが不足するようなら、クラス図に戻って追加、修正しなさい。
. クラス図に追加、修正が済んだら、それを使ってステートマシン図を更新しなさい。
. 外部設計のやりとり（または、ユースケースやユースケース記述）に見合う処置が表現できるまで、クラス図とステートマシン図の修正を繰り返しなさい。

.クラス図とステートマシン図の保存と作業のコミット
. 作成した内部設計のクラス図とステートマシン図をSVG画像として保存しなさい。
** クラス図は、 `images` ディレクトリに `detail_design_class.svg` という名前で保存します（すでに仮の画像がおいてあるので、置き換えます）。
** ステートマシン図は、 `images` ディレクトリに `detail_design_load_cleaner_run_stm.svg` という名前で保存します（すでに仮の画像がおいてあるので、置き換えます）。
. 他のクラスにもステートマシン図を作成したなら、同様にSVG画像として保存しなさい。
** 追加した図は、 `git add` コマンドを使ってリポジトリの追跡対象に追加しなさい。f
. ここまでの作業をコミットします。


[IMPORTANT]
--
この演習では、この段階でコミットできているかどうかも評価します。
コミットを省かないよう、注意してください。
--

画像が保存できていれば、下記のクラス図とステートマシン図が更新されます。

[[detail_design_class_svg]]
.【内部設計書】ロードクリーナーの内部設計のクラス図
image::detail_design_class.svg[ロードクリーナーの内部設計のクラス図, {full-width}]
｀


[[detail_design_load_cleaner_run_stm_svg]]
.【内部設計書】ロードクリーナーの内部設計のステートマシン図
image::detail_design_load_cleaner_run_stm.svg[ロードクリーナーの内部設計のステートマシン図, {full-width}]


== 設計書の文書化

作成した設計書を文書化しなさい。
モデル図が作成できたら、 `asciidoctor` コマンドで HTMLファイルに変換します（ <<asciidoctor_to_html>> ）。

[TIP]
--
Asciidoctor のインストールと使い方については、アセット「 `install_asciidoctor` 」で実施してあります。
わからないことがあれば、そちらを参照しましょう。
--

[[asciidoctor_to_html]]
.【端末】Asciidoc形式のファイルをHTMLに変換する
[example]
--
* 作成した `README.adoc` のあるディレクトリに移動してから実行します。

[source,console]
----
C:\Users\kuboaki\rubybook>asciidoctor README.adoc
----
--

生成されたHTMLファイル（ `README.html` ）をブラウザで表示して、作成した図を反映した文書が生成できていることを確認します。

[IMPORTANT]
--
この演習では、この段階でコミットできているかどうかも評価します。
HTMLファイルを生成したときのコミットを省かないよう、注意してください。
--


